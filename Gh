from docx import Document

def extract_cell_format(cell):
    formatting = {
        'style': cell.paragraphs[0].style,
        'alignment': cell.paragraphs[0].alignment,
        'runs': []
    }

    for paragraph in cell.paragraphs:
        for run in paragraph.runs:
            run_format = {
                'text': run.text,
                'bold': run.bold,
                'italic': run.italic,
                'underline': run.underline,
                'color': run.font.color.rgb,
                'size': run.font.size,
                'name': run.font.name
            }
            formatting['runs'].append(run_format)
    
    # Store borders and shading if necessary
    formatting['borders'] = cell._element.xpath('.//w:tcBorders')
    formatting['shading'] = cell._element.xpath('.//w:shd')
    
    return formatting

def apply_cell_format(target_cell, formatting, new_text):
    # Clear existing content
    target_cell._element.clear_content()
    
    # Add new text to the target cell
    target_paragraph = target_cell.add_paragraph(new_text)
    
    # Apply stored formatting
    target_paragraph.style = formatting['style']
    target_paragraph.alignment = formatting['alignment']
    
    # Create runs with stored formatting
    for run_format in formatting['runs']:
        new_run = target_paragraph.add_run(run_format['text'])
        new_run.bold = run_format['bold']
        new_run.italic = run_format['italic']
        new_run.underline = run_format['underline']
        new_run.font.color.rgb = run_format['color']
        new_run.font.size = run_format['size']
        new_run.font.name = run_format['name']
    
    # Apply borders and shading
    for border in formatting['borders']:
        target_cell._element.append(border)

    if formatting['shading']:
        target_cell._element.append(formatting['shading'][0])

# Load the document
doc = Document('your_document.docx')

# Access the table
table = doc.tables[0]  # Assuming you want the first table

# Extract formatting from a source cell
source_cell = table.cell(0, 0)
formatting = extract_cell_format(source_cell)

# Apply the extracted formatting to multiple cells
new_text = "New text for cell."
for row in range(1, 5):  # Apply to cells in rows 1 to 4, for example
    target_cell = table.cell(row, 0)  # Change column index as needed
    apply_cell_format(target_cell, formatting, new_text)

# Save the document
doc.save('updated_document.docx')
