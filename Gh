Private Sub Workbook_SheetChange(ByVal Sh As Object, ByVal Target As Range)
    If Sh.Name <> "ExcludedSheet" Then
        If Not Intersect(Target, Sh.Range("A2")) Is Nothing Then
            Dim selectedOption As String
            Dim tbl As ListObject
            selectedOption = Sh.Range("A2").Value

            ' Check if a table with the selected name already exists
            On Error Resume Next
            Set tbl = Sh.ListObjects(selectedOption)
            On Error GoTo 0

            If tbl Is Nothing Then
                ' Create a new table if it doesn't exist
                Set tbl = Sh.ListObjects.Add(xlSrcRange, Sh.Range("B5:C5"), , xlYes)
                tbl.Name = selectedOption
                tbl.HeaderRowRange(1).Value = "Column1"
                tbl.HeaderRowRange(2).Value = "Column2"

                ' Add new drop-down for the new table
                AddSecondDropDown Sh, selectedOption
            Else
                ' Add a new row to the existing table
                tbl.ListRows.Add
            End If
        End If
    End If
End Sub




Private Sub AddSecondDropDown(ws As Worksheet, tableName As String)
    Dim ddCell As Range
    Set ddCell = ws.Cells(2, 3) ' Place the second drop-down in cell C2

    ' Add data validation to cell C2 for selecting table names
    With ddCell.Validation
        .Delete
        .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:= _
        xlBetween, Formula1:=GetAllTableNames(ws)
        .IgnoreBlank = True
        .InCellDropdown = True
        .ShowInput = True
        .ShowError = True
    End With
End Sub

Private Function GetAllTableNames(ws As Worksheet) As String
    Dim lo As ListObject
    Dim tableNames As String

    ' Iterate through all tables and get their names
    For Each lo In ws.ListObjects
        If tableNames = "" Then
            tableNames = lo.Name
        Else
            tableNames = tableNames & "," & lo.Name
        End If
    Next lo

    GetAllTableNames = tableNames
End Function
