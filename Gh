import pandas as pd
from rapidfuzz import fuzz

# Load your Excel files
df_large = pd.read_excel("large_file.xlsx")  # 17,936 rows
df_small = pd.read_excel("small_file.xlsx")  # 285 rows

# Replace with your actual column names
large_column = "LargeText"
small_column = "SearchTerm"

# Convert to string just in case
df_large[large_column] = df_large[large_column].astype(str)
df_small[small_column] = df_small[small_column].astype(str)

# Store matches
matches = []

# Threshold for fuzzy match (e.g., 90%)
threshold = 90

# Loop through each small value
for idx, search_term in df_small[small_column].items():
    for large_idx, large_text in df_large[large_column].items():
        score = fuzz.partial_ratio(search_term, large_text)
        if score >= threshold:
            matches.append({
                "SearchTerm": search_term,
                "MatchedText": large_text,
                "SimilarityScore": score,
                "LargeFile_RowIndex": large_idx
            })

# Save matches
matches_df = pd.DataFrame(matches)
matches_df.to_excel("approximate_substring_matches.xlsx", index=False)
