from docx import Document

# Load your Word document
doc = Document("input_document.docx")

# Placeholder to look for
placeholder = "{{add_more}}"

def find_table_with_placeholder(doc, placeholder):
    # Iterate through all tables in the document
    for table in doc.tables:
        # Loop through rows and cells in the table
        for row_idx, row in enumerate(table.rows):
            for cell in row.cells:
                if placeholder in cell.text:
                    return table, row_idx  # Return the table and the row index of the placeholder
    return None, None

def process_table(table, placeholder_row_idx, new_rows_data=None):
    if new_rows_data:
        # Replace the placeholder row with the first row of new data
        placeholder_row = table.rows[placeholder_row_idx]
        
        for idx, cell in enumerate(placeholder_row.cells):
            if idx < len(new_rows_data[0]):
                cell.text = new_rows_data[0][idx]  # Replace the placeholder row with first row of data
        
        # Add any remaining rows (if there's more data after the first row)
        if len(new_rows_data) > 1:
            for row_data in new_rows_data[1:]:
                new_row = table.add_row()  # Add a new row at the end
                table._tbl.insert(placeholder_row_idx + 1, new_row._tr)  # Insert the new row after the placeholder row

                # Populate the newly inserted row with data
                for idx, data in enumerate(row_data):
                    new_row.cells[idx].text = data

                # Update the placeholder_row_idx so new rows are inserted sequentially
                placeholder_row_idx += 1

# Call the function to find the table with the placeholder
target_table, placeholder_row_idx = find_table_with_placeholder(doc, placeholder)

if target_table and placeholder_row_idx is not None:
    # If placeholder is found, replace it with new rows
    new_rows_data = [
        ["Alice Smith", "25", "New York"],
        ["Bob Johnson", "30", "San Francisco"]
    ]
    process_table(target_table, placeholder_row_idx, new_rows_data=new_rows_data)

    # Save the modified document
    doc.save("updated_document.docx")
    print("Table updated successfully!")
else:
    print("Placeholder not found in any table.")
