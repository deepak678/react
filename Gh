Private Sub Workbook_SheetChange(ByVal Sh As Object, ByVal Target As Range)
    On Error GoTo ErrorHandler
    Application.EnableEvents = False ' Disable events temporarily

    Dim updateTypeColumn As Integer
    updateTypeColumn = 2 ' Assuming "Update Type" column is column 2

    ' Check if the change is on a sheet other than "Mapping" and in the specified column
    If Sh.Name <> "Mapping" And Target.Column = updateTypeColumn Then

        ' Ensure the change is only processed for single-cell updates
        If Target.Cells.Count = 1 Then
            Dim selectedOption As String
            selectedOption = Target.Value

            ' Proceed only if a valid selection is made from the drop-down and it's not "Update Type"
            If selectedOption <> "" And selectedOption <> "Update Type" Then

                ' Clear any existing tables in the sheet to avoid overlapping tables
                ClearExistingTables Sh

                ' Define starting row for the new table
                Dim startRow As Long
                startRow = 3 ' Adjust as per your specific starting row

                ' Create or update table with headers based on selected option
                CreateOrUpdateTable Sh, startRow, selectedOption

            End If
        End If
    End If

ExitHandler:
    Application.EnableEvents = True ' Re-enable events
    Exit Sub

ErrorHandler:
    MsgBox "An error occurred: " & Err.Description & " in " & Err.Source
    Resume ExitHandler
End Sub

Private Sub ClearExistingTables(ByVal Sh As Worksheet)
    ' Clear all existing tables in the sheet
    Dim tbl As ListObject
    For Each tbl In Sh.ListObjects
        tbl.Delete
    Next tbl
End Sub

Private Sub CreateOrUpdateTable(ByVal Sh As Worksheet, ByVal startRow As Long, ByVal selectedOption As String)
    ' Define table range starting from startRow
    Dim headerRow As Long
    headerRow = startRow ' Start from the specified startRow
    Dim tableStart As Range
    Set tableStart = Sh.Cells(headerRow, 1) ' Start from the row with headers
    Dim tableEnd As Range
    Set tableEnd = Sh.Cells(headerRow + 1, 1) ' Assuming the table has one row initially

    ' Add new table if it doesn't exist
    Dim newTbl As ListObject
    On Error Resume Next
    Set newTbl = Sh.ListObjects("Table_" & Replace(selectedOption, " ", "_"))
    On Error GoTo 0

    If newTbl Is Nothing Then
        Set newTbl = Sh.ListObjects.Add(xlSrcRange, Sh.Range(tableStart, tableEnd), , xlYes)
        newTbl.Name = "Table_" & Replace(selectedOption, " ", "_") ' Unique name for each table
        
        ' Add serial number column as the first column
        newTbl.ListColumns.Add Position:=1
        newTbl.HeaderRowRange.Cells(1, 1).Value = "Serial No."

        ' Add headers based on selected option
        Select Case selectedOption
            Case "Update Paragraph"
                With newTbl
                    .ListColumns.Add Position:=2
                    .HeaderRowRange.Cells(1, 2).Value = "Header Level"
                    .HeaderRowRange.Cells(1, 3).Value = "Before Header"
                    .HeaderRowRange.Cells(1, 4).Value = "Before Paragraph No."
                    .HeaderRowRange.Cells(1, 5).Value = "Content"
                End With
            Case "Update Text"
                With newTbl
                    .ListColumns.Add Position:=2
                    .HeaderRowRange.Cells(1, 2).Value = "Reference"
                    .HeaderRowRange.Cells(1, 3).Value = "Old Text"
                    .HeaderRowRange.Cells(1, 4).Value = "New Text"
                End With
            Case "Update Front Page"
                With newTbl
                    .ListColumns.Add Position:=2
                    .HeaderRowRange.Cells(1, 2).Value = "Reference"
                    .HeaderRowRange.Cells(1, 3).Value = "New Text"
                End With
            Case "Placeholder Update"
                With newTbl
                    .ListColumns.Add Position:=2
                    .HeaderRowRange.Cells(1, 2).Value = "Placeholder Key"
                    .HeaderRowRange.Cells(1, 3).Value = "Placeholder Value"
                End With
            Case Else
                ' Handle other cases if needed
        End Select
        
        newTbl.TableStyle = "TableStyleMedium2" ' Apply table style (optional)
    End If
End Sub
