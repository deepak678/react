Private Sub Workbook_SheetChange(ByVal Sh As Object, ByVal Target As Range)
    On Error GoTo ErrorHandler
    Application.EnableEvents = False ' Disable events temporarily

    Dim updateTypeColumn As Integer
    updateTypeColumn = 2 ' Assuming "Update Type" column is column 2

    ' Check if the change is on a sheet other than "Mapping" and in the specified column
    If Sh.Name <> "Mapping" And Target.Column = updateTypeColumn Then

        ' Ensure the change is only processed for single-cell updates
        If Target.Cells.Count = 1 Then
            Dim selectedOption As String
            selectedOption = Target.Value

            ' Proceed only if a valid selection is made from the drop-down
            If selectedOption <> "" Then

                ' Determine the number of operations based on entries in "Update Type" column
                Dim numOperations As Integer
                numOperations = Application.WorksheetFunction.CountA(Sh.Columns(updateTypeColumn)) - 1 ' Subtract header row

                ' Insert a new row for the new block
                Dim newRow As Long
                newRow = Target.Row + 1
                Sh.Rows(newRow).Insert Shift:=xlDown

                ' Insert header for the new block
                Dim headerRow As Long
                headerRow = newRow + 1
                Sh.Cells(headerRow, 1).Value = numOperations & ": " & selectedOption

                ' Define headers for different update types
                Dim headers As Variant
                Select Case selectedOption
                    Case "Update Paragraph"
                        headers = Array("Serial No.", "Paragraph Header Level", "Before Header", "Before Paragraph No.", "Content")
                    Case "Update Text"
                        headers = Array("Serial No.", "Reference", "Old Text", "New Text")
                    Case "Update Front Page"
                        headers = Array("Serial No.", "Reference", "New Text")
                    Case "Placeholder Update"
                        headers = Array("Serial No.", "Placeholder Key", "Placeholder Value")
                    Case Else
                        ' Default case if none of the above options match
                        headers = Array("Please select an option in Update Type")
                End Select

                ' Populate headers in the new block
                Dim i As Integer
                For i = LBound(headers) To UBound(headers)
                    Sh.Cells(headerRow + 1, i + 1).Value = headers(i)
                Next i

                ' Apply table formatting
                CreateOrUpdateTable Sh, headerRow, headers

                ' Disable the selected option in the drop-down
                DisableSelectedOption Sh, Target, selectedOption
            End If
        End If
    End If

ExitHandler:
    Application.EnableEvents = True ' Re-enable events
    Exit Sub

ErrorHandler:
    MsgBox "An error occurred: " & Err.Description & " in " & Err.Source
    Resume ExitHandler
End Sub

Private Sub CreateOrUpdateTable(ByVal Sh As Worksheet, ByVal headerRow As Long, ByVal headers As Variant)
    Dim lastRow As Long
    lastRow = Sh.Cells(Sh.Rows.Count, 1).End(xlUp).Row

    ' Define table range
    Dim tableStart As Range
    Set tableStart = Sh.Cells(headerRow + 1, 1) ' Start from the row with headers
    Dim tableEnd As Range
    Set tableEnd = Sh.Cells(headerRow + 2, UBound(headers) + 1) ' Assume the table has one row initially

    ' Check if a table exists in the target range and delete it if found
    Dim tbl As ListObject
    For Each tbl In Sh.ListObjects
        If Not Intersect(tbl.Range, Sh.Range(tableStart, tableEnd)) Is Nothing Then
            tbl.Delete
            Exit For
        End If
    Next tbl

    ' Add new table
    Dim newTbl As ListObject
    Set newTbl = Sh.ListObjects.Add(xlSrcRange, Sh.Range(tableStart, tableEnd), , xlYes)
    newTbl.Name = "Table_" & Format(Date, "yyyymmdd_hhmmss") ' Unique name for each table

    ' Apply table style (optional)
    newTbl.TableStyle = "TableStyleMedium2" ' Change as per your preference
End Sub

Private Sub DisableSelectedOption(ByVal Sh As Worksheet, ByVal Target As Range, ByVal selectedOption As String)
    Dim dv As Validation
    Set dv = Target.Validation

    If Not dv Is Nothing Then
        Dim options As Variant
        options = Split(dv.Formula1, ",")

        Dim newOptions As String
        Dim i As Integer
        For i = LBound(options) To UBound(options)
            If Trim(options(i)) <> selectedOption Then
                If newOptions = "" Then
                    newOptions = Trim(options(i))
                Else
                    newOptions = newOptions & "," & Trim(options(i))
                End If
            End If
        Next i

        ' Apply the new list without the selected option
        Target.Validation.Delete
        If newOptions <> "" Then
            Target.Validation.Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:= _
                xlBetween, Formula1:=newOptions
        End If
    End If
End Sub
